import{initializeApp}from"https://www.gstatic.com/firebasejs/9.9.1/firebase-app.js";import{getFirestore,doc,getDocs,setDoc,collection,addDoc,updateDoc,deleteDoc,deleteField,query,orderBy}from"https://www.gstatic.com/firebasejs/9.9.1/firebase-firestore.js";const firebaseConfig={apiKey:"AIzaSyAhvE0ap8qYEJCJ8SdKqMujYZqNxOP8T80",authDomain:"travel-with-love.firebaseapp.com",projectId:"travel-with-love",storageBucket:"travel-with-love.appspot.com",messagingSenderId:"847927457891",appId:"1:847927457891:web:1ec1221a6e2b023733e056"},app=initializeApp(firebaseConfig),db=getFirestore(),locationCollection=collection(db,"locations");let INDEXES=0,locationArr=[];function loadUI(){let e=document.getElementById("addLocationButton"),t=document.getElementById("saveLocationBtn"),a=document.getElementById("addLocDescriptionMoreBtn"),d=document.getElementById("addLocLinkMore");var n=new bootstrap.Modal(document.getElementById("addModal"),{keyboard:!1});e.addEventListener("click",(e=>{n.show()})),a.addEventListener("click",(e=>{let t=document.getElementById("addLocDescriptionStack"),a=document.createElement("div");a.classList.add("row"),a.classList.add("mb-1");let d=document.createElement("div");d.classList.add("col");let n=document.createElement("input");n.classList.add("form-control"),n.name="addLocDescription",d.appendChild(n),a.appendChild(d),t.appendChild(a)})),d.addEventListener("click",(e=>{let t=document.getElementById("addLocLinkStack"),a=document.createElement("div");a.classList.add("row"),a.classList.add("mb-1");let d=document.createElement("div");d.classList.add("col-3");let n=document.createElement("label");n.innerText="Name";let l=document.createElement("div");l.classList.add("col-9");let i=document.createElement("input");i.classList.add("form-control"),i.name="addLocLinkName",d.appendChild(n),l.appendChild(i),a.appendChild(d),a.appendChild(l),t.appendChild(a);let o=document.createElement("div");o.classList.add("row"),o.classList.add("mb-1");let c=document.createElement("div");c.classList.add("col-3");let s=document.createElement("label");s.innerText="Link";let r=document.createElement("div");r.classList.add("col-9");let m=document.createElement("input");m.classList.add("form-control"),m.name="addLocLinkURL",c.appendChild(s),r.appendChild(m),o.appendChild(c),o.appendChild(r),t.appendChild(o)})),t.addEventListener("click",(async e=>{let t=document.getElementById("addLocTitle"),a=document.getElementById("addLocImage"),d=document.getElementById("addLocIsVisited"),l=document.getElementsByName("addLocDescription"),i=document.getElementsByName("addLocLinkName"),o=document.getElementsByName("addLocLinkURL");if(""==t.value)return void alert("Title can not be empty");""==d.value&&(d.value="No");let c=[];for(let e=0;e<l.length;e++)""!=l[e].value&&c.push(l[e].value);let s=[];for(let e=0;e<i.length;e++)""!=i[e].value&&""!=o[e].value&&s.push({name:i[e].value,link:o[e].value});let r={position:INDEXES,title:t.value,image:a.value,isVisited:d.value,description:c,links:s};await addDoc(locationCollection,{el:r}).then((()=>{alert("Location added successfully"),n.hide(),location.reload()})).catch((e=>{alert("Location added failed"+e)}))}))}async function addLocation(e){await addDoc(locationCollection,{el:e}).then((()=>{alert("Location added successfully")})).catch((e=>{alert("Location added failed"+e)}))}async function getLocations(){await getDocs(query(locationCollection,orderBy("el.position","desc"))).then((e=>{e.forEach((e=>{locationArr.push({id:e.id,...e.data().el})})),loadLocationDetailsWithFirebase()})).catch((e=>alert("Failed to retrieve data"+e)))}function loadXMLDoc(){var e=new XMLHttpRequest;e.onreadystatechange=function(){4==this.readyState&&200==this.status&&loadLocationDetailsWithXML(this)},e.open("GET","locations.xml",!0),e.send()}function loadLocationDetailsWithXML(e){let t=e.responseXML.getElementsByTagName("location"),a=document.getElementById("locations");INDEXES=t.length;for(let e=0;e<t.length;e++){let d={position:e},n=t[e].getElementsByTagName("title")[0].innerHTML,l=t[e].getElementsByTagName("image")[0].innerHTML;if(""==n)continue;l=decodeURIComponent(l),d.title=n,d.image=l;let i=document.createElement("div");i.classList.add("col"),i.id=`index${e}`;let o=document.createElement("div");o.classList.add("card"),i.appendChild(o);let c=document.createElement("img");c.classList.add("card-img-top"),c.setAttribute("src",l),o.appendChild(c);let s=document.createElement("div");s.classList.add("card-body"),o.appendChild(s);let r=document.createElement("h5");r.innerText=n,s.appendChild(r);let m=t[e].getElementsByTagName("description"),p=[];for(let t=0;t<m.length;t++){let a=document.createElement("p");a.classList.add("card-text"),a.classList.add(`index${e}`),a.innerHTML=m[t].innerHTML,p.push(m[t].innerHTML),s.appendChild(a)}d.description=p;let u=t[e].getElementsByTagName("isVisited")[0].innerHTML,L=document.createElement("div");L.classList.add("card-body");let h=document.createElement("ul");h.classList.add("list-group"),h.classList.add("list-group-flush");let E=document.createElement("li");E.classList.add("list-group-item"),E.innerHTML=`Visited: ${u}`,h.appendChild(E),d.isVisited=u;let g=t[e].getElementsByTagName("link"),y=[];for(let e=0;e<g.length;e++){let t=document.createElement("li");t.classList.add("list-group-item");let a=document.createElement("a");a.setAttribute("target","_blank"),a.setAttribute("href",g[e].getElementsByTagName("url")[0].innerHTML),a.innerHTML=g[e].getElementsByTagName("name")[0].innerHTML,y.push({name:g[e].getElementsByTagName("name")[0].innerHTML,link:g[e].getElementsByTagName("url")[0].innerHTML}),t.appendChild(a),h.appendChild(t)}d.links=y,L.appendChild(h),o.appendChild(L),a.appendChild(i)}handleVisibilityOption()}function loadLocationDetailsWithFirebase(){let e=document.getElementById("locations");INDEXES=locationArr.length;for(let t=0;t<locationArr.length;t++){let a=locationArr[t].title,d=locationArr[t].image;if(""==a)continue;let n=document.createElement("div");n.classList.add("col"),n.id=`index${t}`;let l=document.createElement("div");l.classList.add("card"),n.appendChild(l);let i=document.createElement("img");i.classList.add("card-img-top"),i.setAttribute("src",d),l.appendChild(i);let o=document.createElement("div");o.classList.add("card-body"),l.appendChild(o);let c=document.createElement("h5");c.innerText=a,o.appendChild(c);let s=locationArr[t].description;for(let e=0;e<s.length;e++){let a=document.createElement("p");a.classList.add("card-text"),a.classList.add(`index${t}`),a.innerHTML=s[e],o.appendChild(a)}let r=locationArr[t].isVisited,m=document.createElement("div");m.classList.add("card-body");let p=document.createElement("ul");p.classList.add("list-group"),p.classList.add("list-group-flush");let u=document.createElement("li");u.classList.add("list-group-item"),u.innerHTML=`Visited: ${r}`,p.appendChild(u);let L=locationArr[t].links;for(let e=0;e<L.length;e++){let t=document.createElement("li");t.classList.add("list-group-item");let a=document.createElement("a");a.setAttribute("target","_blank"),a.setAttribute("href",L[e].link),a.innerHTML=L[e].name,t.appendChild(a),p.appendChild(t)}m.appendChild(p),l.appendChild(m),e.appendChild(n)}handleVisibilityOption()}function handleVisibilityOption(){for(let e=0;e<INDEXES-1;e++){document.getElementById(`index${e}`).addEventListener("click",(t=>{let a=document.getElementsByClassName(`index${e}`);for(let e of a)e.classList.contains("d-none")?e.classList.remove("d-none"):e.classList.add("d-none")}))}}loadUI(),getLocations();